#include "stdlib.h"
#include "stdio.h"
#include "living_docs.h"

<% example_function_names.each do |function_name| %>
int <%= function_name %>();
<% end %>

<%= preamble %>

void __living_docs_entry_point() {
  printf("Running examples...\n");
  int failed = 0;
  int total = <%= example_function_names.length %>;
<% example_function_names.each do |function_name| %>
  if(<%= function_name %>()) {
    ++failed;
    printf("\x1b[31mF\x1b[0m");
  } else {
    printf("\x1b[32m.\x1b[0m");
  }
  fflush(stdout);
<% end %>
  if(failed) {
    printf("\n\n\x1b[31m%d/%d examples failed.\x1b[0m\n", failed, total);
  } else {
    printf("\n\n\x1b[32mAll %d examples ran successfully.\x1b[0m\n", total);
  }
  exit(0);
}
